<!doctype html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Apple Music Style Player No Artwork</title>
  <style>
    :root {
      --bg: #f5f5f7;
      --card: #fff;
      --muted: #6b6b70;
      --accent: #0071e3;
      --text: #0b0b0b;
      --now: #ffffff;
    }
    [data-theme="dark"] {
      --bg: #0b0b0d;
      --card: #0f0f11;
      --muted: #9a9a9a;
      --accent: #1db954;
      --text: #e7e7e7;
      --now: #0c0c0d;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
    }
    .app {
      display: flex;
      height: 100vh;
      gap: 18px;
      padding: 18px;
    }
    .sidebar {
      width: 260px;
      background: var(--card);
      border-radius: 12px;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }
    .sidebar h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.5px;
    }
    .sidebar .nav button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }
    .sidebar .nav button:hover {
      color: var(--text);
      background: rgba(0,0,0,0.03);
    }
    .sidebar .playlists {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 40vh;
      overflow: auto;
      padding-right: 6px;
    }
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .top {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    }
    .search {
      flex: 1;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.06);
      background: transparent;
      color: var(--text);
      font-size: 15px;
      transition: border-color 0.3s ease;
    }
    .search:focus {
      outline: none;
      border-color: var(--accent);
    }
    .controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: transparent;
      cursor: pointer;
      color: var(--muted);
      font-size: 14px;
      transition: color 0.3s ease, background-color 0.3s ease;
    }
    .btn:hover {
      color: var(--text);
      background: rgba(0,0,0,0.03);
    }
    .content {
      flex: 1;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }
    .list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .card {
      background: var(--card);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
      display: flex;
      align-items: center;
      padding: 12px 16px;
      user-select:none;
      cursor: pointer;
      justify-content: space-between;
    }
    .card:hover {
      background: rgba(0,0,0,0.05);
    }
    .meta {
      flex: 1;
      user-select:text;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: 600;
      font-size: 16px;
    }
    .smallbtn {
      background: transparent;
      border: none;
      color: var(--accent);
      cursor: pointer;
      font-size: 20px;
      padding: 4px 8px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
    }
    .smallbtn:hover {
      background-color: var(--accent);
      color: #fff;
    }
    /* Now playing bar */
    .nowbar {
      height: 72px;
      background: var(--now);
      border-radius: 12px;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      gap: 14px;
      box-shadow: 0 -6px 18px rgba(0,0,0,0.04);
      user-select:none;
    }
    .now-mid {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
      user-select:none;
    }
    .now-mid .title {
      font-weight: 700;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 18px;
    }
    .now-mid .artist {
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .now-controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      user-select:none;
    }
    .play-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .bigbtn {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      user-select:none;
    }
    .iconbtn {
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 18px;
      user-select:none;
    }
    /* responsive */
    @media (max-width:900px) {
      .sidebar {
        display: none;
      }
    }
  </style>
</head>
<body data-theme="light">
  <div style="padding:12px 16px">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
      <h2 style="margin:0">MUSICMUSICMUSIC</h2>
      <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
        <label style="font-size:13px;color:var(--muted); user-select:none;">Dark</label>
        <input id="themeToggle" type="checkbox" />
      </div>
    </div>

    <div class="app">
      <aside class="sidebar">
        <h1>Library</h1>
        <div class="nav">
          <button onclick="showAll()">All Songs</button>
          <button onclick="showPlaylists()">Playlists</button>
          <button onclick="showSearch()">Search</button>
        </div>

        <div style="margin-top:6px;display:flex;gap:8px">
          <input id="newPlaylistName" placeholder="New playlist" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)" />
          <button class="btn" onclick="createPlaylist()">➕</button>
        </div>

        <div class="playlists" id="playlistList"></div>
      </aside>

      <main class="main">
        <div class="top">
          <input id="searchInput" class="search" placeholder="Search songs, artists..." />
          <div class="controls">
            <button class="btn" id="viewToggle">List</button>
            <button class="btn" id="sortBtn">Sort: A→Z</button>
            <button class="btn" id="shuffleBtn">Shuffle ⤨</button>
            <button class="btn" id="repeatBtn">Repeat: Off</button>
          </div>
        </div>

        <div class="content" id="contentArea">
          <div id="tracks" class="list"></div>
          <div id="empty" style="display:none;padding:20px;color:var(--muted)">No tracks found.</div>
        </div>

        <div class="nowbar" id="nowbar">
          <div class="now-mid">
            <div id="nowTitle" class="title">Not playing</div>
            <div id="nowArtist" class="artist"></div>
          </div>

          <div class="now-controls">
            <div class="play-controls">
              <button class="iconbtn" onclick="prevTrack()">⏮️</button>
              <button class="bigbtn" id="playPause" onclick="togglePlay()">▶️</button>
              <button class="iconbtn" onclick="nextTrack()">⏭️</button>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <audio id="audio" crossorigin="anonymous"></audio>

  <script>
    // CONFIG
    const folderId = '1DGz9zEQh29EAqTZpmWK5mwSj5HComnkn';  // Your Google Drive folder ID
    const apiKey = 'AIzaSyDsYE91wH7UDwu8eZNbD1CFuVcilgYeZhI';  // Your Google API key

    // STATE
    let tracks = [];
    let filteredTracks = [];
    let playlists = JSON.parse(localStorage.getItem('mm_playlists') || '{}');
    let queue = [];
    let currentIndex = -1;
    let isPlaying = false;
    let shuffle = false;
    let repeatMode = 0;  // 0=off, 1=all, 2=one

    // DOM
    const tracksEl = document.getElementById('tracks');
    const searchInput = document.getElementById('searchInput');
    const playPauseBtn = document.getElementById('playPause');
    const audio = document.getElementById('audio');
    const nowTitle = document.getElementById('nowTitle');
    const nowArtist = document.getElementById('nowArtist');
    const playlistList = document.getElementById('playlistList');
    const newPlaylistNameInput = document.getElementById('newPlaylistName');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const repeatBtn = document.getElementById('repeatBtn');
    const sortBtn = document.getElementById('sortBtn');
    const viewToggle = document.getElementById('viewToggle');

    // Load tracks from Google Drive folder
    async function loadTracks() {
      tracks = [];
      let pageToken = '';
      try {
        do {
          const q = encodeURIComponent(`'${folderId}' in parents and (mimeType contains 'audio/')`);
          const url = `https://www.googleapis.com/drive/v3/files?q=${q}&fields=nextPageToken,files(id,name,mimeType)&pageSize=100${pageToken ? `&pageToken=${pageToken}` : ''}&key=${apiKey}`;
          const res = await fetch(url);
          const data = await res.json();
          if (data.files) {
            tracks = tracks.concat(data.files);
          }
          pageToken = data.nextPageToken || '';
        } while(pageToken);
        tracks.sort((a,b) => a.name.localeCompare(b.name));
        filteredTracks = [...tracks];
        renderTrackList();
      } catch(err) {
        alert('Error loading tracks from Google Drive.');
        console.error(err);
      }
    }

    // Render track list UI
    function renderTrackList() {
      tracksEl.innerHTML = '';
      if(filteredTracks.length === 0) {
        document.getElementById('empty').style.display = 'block';
        return;
      } else {
        document.getElementById('empty').style.display = 'none';
      }
      filteredTracks.forEach((track, i) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.textContent = track.name;
        div.onclick = () => playTrack(i);

        // Add playlist add/remove buttons if playlist view or all songs
        if(currentView === 'playlists') {
          // Show remove button in playlist view
          const removeBtn = document.createElement('button');
          removeBtn.className = 'smallbtn';
          removeBtn.textContent = '−';
          removeBtn.title = 'Remove from playlist';
          removeBtn.onclick = (e) => {
            e.stopPropagation();
            removeFromPlaylist(currentPlaylist, track);
          };
          div.appendChild(removeBtn);
        } else {
          // Show add to playlist button
          const addBtn = document.createElement('button');
          addBtn.className = 'smallbtn';
          addBtn.textContent = '+';
          addBtn.title = 'Add to playlist';
          addBtn.onclick = (e) => {
            e.stopPropagation();
            showPlaylistMenu(e, track);
          };
          div.appendChild(addBtn);
        }
        tracksEl.appendChild(div);
      });
      highlightCurrentTrack();
    }

    // Play a track by index
    function playTrack(index) {
      if(index < 0 || index >= filteredTracks.length) return;
      currentIndex = index;
      const track = filteredTracks[index];
      audio.src = `https://www.googleapis.com/drive/v3/files/${track.id}?alt=media&key=${apiKey}`;
      nowTitle.textContent = track.name;
      nowArtist.textContent = ''; // No artist info available from Drive
      audio.play().catch(() => {});
      isPlaying = true;
      updatePlayPauseButton();
      highlightCurrentTrack();
    }

    // Highlight currently playing track in list
    function highlightCurrentTrack() {
      const cards = tracksEl.querySelectorAll('.card');
      cards.forEach((card, i) => {
        card.style.background = (i === currentIndex) ? 'rgba(29, 185, 84, 0.15)' : '';
      });
    }

    // Play controls
    function togglePlay() {
      if(isPlaying) {
        audio.pause();
        isPlaying = false;
      } else {
        audio.play().catch(() => {});
        isPlaying = true;
      }
      updatePlayPauseButton();
    }
    function updatePlayPauseButton() {
      playPauseBtn.textContent = isPlaying ? '⏸️' : '▶️';
    }
    function nextTrack() {
      if(shuffle) {
        playTrack(Math.floor(Math.random() * filteredTracks.length));
      } else {
        if(currentIndex + 1 < filteredTracks.length) {
          playTrack(currentIndex + 1);
        } else if(repeatMode === 1) {
          playTrack(0);
        }
      }
    }
    function prevTrack() {
      if(currentIndex > 0) {
        playTrack(currentIndex - 1);
      }
    }

    // Repeat toggle
    function toggleRepeat() {
      repeatMode = (repeatMode + 1) % 3;
      const labels = ['Off', 'All', 'One'];
      repeatBtn.textContent = 'Repeat: ' + labels[repeatMode];
    }

    // Shuffle toggle
    function toggleShuffle() {
      shuffle = !shuffle;
      shuffleBtn.style.color = shuffle ? 'var(--accent)' : 'var(--muted)';
    }

    // Search filter
    function filterTracks() {
      const q = searchInput.value.toLowerCase();
      filteredTracks = tracks.filter(t => t.name.toLowerCase().includes(q));
      renderTrackList();
    }

    // Playlist support
    let currentView = 'all'; // 'all' | 'playlists' | 'search'
    let currentPlaylist = '';

    function savePlaylists() {
      localStorage.setItem('mm_playlists', JSON.stringify(playlists));
      renderPlaylists();
    }
    function createPlaylist() {
      const name = newPlaylistNameInput.value.trim();
      if(name && !playlists[name]) {
        playlists[name] = [];
        savePlaylists();
        newPlaylistNameInput.value = '';
        showPlaylists();
      }
    }
    function renderPlaylists() {
      playlistList.innerHTML = '';
      for(let pl in playlists) {
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = pl;
        btn.onclick = () => {
          currentView = 'playlists';
          currentPlaylist = pl;
          filteredTracks = playlists[pl];
          renderTrackList();
        };
        playlistList.appendChild(btn);
      }
    }
    function showAll() {
      currentView = 'all';
      filteredTracks = [...tracks];
      renderTrackList();
    }
    function showPlaylists() {
      currentView = 'playlists';
      renderPlaylists();
      tracksEl.innerHTML = '<p style="color:var(--muted)">Select a playlist from left.</p>';
    }
    function showSearch() {
      currentView = 'search';
      filteredTracks = [...tracks];
      renderTrackList();
    }
    function addToPlaylist(pl, track) {
      if(!playlists[pl]) playlists[pl] = [];
      if(!playlists[pl].some(t => t.id === track.id)) {
        playlists[pl].push(track);
        savePlaylists();
      }
    }
    function removeFromPlaylist(pl, track) {
      if(!playlists[pl]) return;
      playlists[pl] = playlists[pl].filter(t => t.id !== track.id);
      savePlaylists();
      filteredTracks = playlists[pl];
      renderTrackList();
    }
    // Show playlist menu on add button click
    function showPlaylistMenu(e, track) {
      const menu = document.createElement('div');
      menu.style.position = 'absolute';
      menu.style.background = 'var(--card)';
      menu.style.border = '1px solid rgba(0,0,0,0.1)';
      menu.style.borderRadius = '8px';
      menu.style.boxShadow = '0 2px 12px rgba(0,0,0,0.1)';
      menu.style.padding = '8px';
      menu.style.zIndex = 1000;
      menu.style.top = (e.clientY + 10) + 'px';
      menu.style.left = (e.clientX + 10) + 'px';
      for(let pl in playlists) {
        const btn = document.createElement('button');
        btn.textContent = pl;
        btn.style.display = 'block';
        btn.style.width = '100%';
        btn.style.marginBottom = '6px';
        btn.onclick = () => {
          addToPlaylist(pl, track);
          document.body.removeChild(menu);
        };
        menu.appendChild(btn);
      }
      if(Object.keys(playlists).length === 0) {
        const msg = document.createElement('div');
        msg.textContent = 'No playlists. Create one above.';
        menu.appendChild(msg);
      }
      document.body.appendChild(menu);
      // Remove menu on outside click
      function onClickOutside(event) {
        if(!menu.contains(event.target)) {
          document.body.removeChild(menu);
          document.removeEventListener('click', onClickOutside);
        }
      }
      document.addEventListener('click', onClickOutside);
    }

    // Sort tracks alphabetically or reverse
    let sortAsc = true;
    function toggleSort() {
      filteredTracks.sort((a,b) => sortAsc ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name));
      sortAsc = !sortAsc;
      sortBtn.textContent = 'Sort: ' + (sortAsc ? 'A→Z' : 'Z→A');
      renderTrackList();
    }

    // View toggle between list (only list now for simplicity)
    function toggleView() {
      // For now, only list view implemented
      alert('Only list view available now.');
    }

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('change', () => {
      document.body.dataset.theme = themeToggle.checked ? 'dark' : 'light';
    });

    // Events
    searchInput.addEventListener('input', filterTracks);
    shuffleBtn.addEventListener('click', toggleShuffle);
    repeatBtn.addEventListener('click', toggleRepeat);
    sortBtn.addEventListener('click', toggleSort);
    viewToggle.addEventListener('click', toggleView);
    audio.addEventListener('ended', () => {
      if(repeatMode === 2) {
        playTrack(currentIndex);
      } else {
        nextTrack();
      }
    });

    // Init
    loadTracks();
    renderPlaylists();

  </script>
</body>
</html>
